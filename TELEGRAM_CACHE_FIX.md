# 텔레그램 앱 반영 안 될 때 (캐시/배포 확인)

## 1. 수정이 안 보일 때 체크리스트

### A. 배포가 실제로 됐는지 확인
1. **Vercel 대시보드** → 사용 중인 프로젝트(예: oneiro83app 또는 oneiro-app-jxuu) 클릭
2. **Deployments** 탭에서 **가장 최근 배포가 성공(Ready)** 인지 확인
3. **어떤 GitHub 브랜치**가 프로덕션으로 연결돼 있는지 확인 (보통 `main`)
4. 로컬에서 수정한 뒤 **반드시 `git push`** 했는지 확인

### B. 봇이 여는 URL이 배포한 URL과 같은지 확인
1. **BotFather** (텔레그램) → 봇 선택 → **Bot Settings** → **Menu Button** 또는 **Web App** URL 확인
2. 적혀 있는 주소가 **지금 Vercel에서 배포 중인 URL**과 **완전히 동일**한지 확인  
   - 예: 봇 URL이 `https://oneiro-app-jxuu.vercel.app` 인데, 실제 배포는 `https://oneiro83app-xxx.vercel.app` 라면 **다른 앱**을 여는 것임 → Vercel에서 **실제 배포하는 프로젝트의 URL**을 봇 URL에 맞추거나, 봇 URL을 그 프로젝트 URL로 바꿔야 함

### C. 텔레그램 캐시 때문에 예전 버전이 보이는 경우
텔레그램 미니앱은 **캐시를 오래** 씁니다. 아래 순서로 시도하세요.

**방법 1: URL에 버전 붙이기 (가장 확실)**  
1. BotFather에서 **Web App / Menu Button URL**을 다음처럼 바꿉니다.  
   - 기존: `https://oneiro83app-xxx.vercel.app`  
   - 변경: `https://oneiro83app-xxx.vercel.app/?v=2`  
   (숫자만 바꿔도 새로 불러옵니다.)
2. 봇 대화에서 **앱 메뉴/버튼으로 다시 들어갑니다.**
3. 이제 최신 번들이 로드됐는지 화면으로 확인합니다.
4. 반영됐으면 나중에 `?v=2` 를 다시 제거해도 됩니다.

**방법 2: 텔레그램 캐시 비우기**  
- **Android**: 설정 → 데이터 및 저장공간 → 저장공간 사용량 → 캐시 삭제  
- **iOS**: 앱 삭제 후 재설치하거나, 설정에서 저장공간 정리  
- 그 다음 봇에서 **앱 링크를 다시 눌러** 들어갑니다.

**방법 3: 시크릿/다른 기기에서 테스트**  
- 같은 URL을 **PC 브라우저 시크릿 창**이나 **다른 사람 폰**에서 열어봅니다.  
- 거기선 새로 받기 때문에, 그쪽에만 반영돼 있으면 **캐시 문제**가 맞습니다.

---

## 2. 쿠키/URL을 바꿔야 하나?

- **쿠키를 바꿀 필요는 없습니다.** 언어는 `localStorage`에 저장되고, 수정 반영은 **캐시된 JS/HTML** 문제입니다.
- **URL을 “바꿔야” 하는 경우**는 딱 하나입니다:  
  **봇이 여는 URL ≠ 실제로 배포한 Vercel 프로젝트 URL** 일 때.  
  이때는 BotFather에서 **Web App URL을 “지금 배포 중인 Vercel URL”로** 맞춰주면 됩니다.

---

## 3. 텔레그램 앱을 다시 만들어야 하나?

- **아니요.** 봇/앱을 새로 만들 필요 없습니다.
- 봇은 “그냥 URL 하나”만 열어줍니다.  
  **그 URL이 최신이 들어 있는 Vercel 배포 주소**이고, **캐시를 우회해 불러오면** 수정이 반영됩니다.
- 위 1번(A, B, C)만 순서대로 하면 됩니다.

---

## 4. 한 번에 확인하는 순서 (요약)

1. **코드 푸시**  
   `git add .` → `git commit -m "..."` → `git push`
2. **Vercel**에서 해당 프로젝트 **최신 배포 성공** 확인.
3. **BotFather** Web App URL이 **그 Vercel 프로젝트의 URL**과 같은지 확인.
4. **캐시 우회**: URL에 `?v=2` 붙여서 봇 URL 수정 후, 봇에서 앱 다시 들어가서 확인.

이후에도 반영이 안 되면, Vercel 배포 로그에서 **빌드 에러**가 있는지, 그리고 **프로덕션 배포가 그 브랜치에서 이뤄졌는지** 한 번 더 확인하면 됩니다.
